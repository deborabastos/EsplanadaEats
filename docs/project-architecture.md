# Esplanada Eats - Documentação de Arquitetura do Projeto

## Introdução

Este documento captura o ESTADO ATUAL do projeto Esplanada Eats, incluindo requisitos, design e planejamento de implementação. Este é um projeto em fase de planejamento com documentação completa para desenvolvimento futuro.

### Document Scope

Projeto completo: Aplicativo web single-page para cadastro e avaliação de restaurantes com armazenamento em nuvem usando Firebase Firestore.

### Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-13 | 1.0 | Análise completa do projeto em fase de planejamento | Mary (Business Analyst) |
| 2025-09-25 | 2.0 | Atualização para arquitetura Firebase com armazenamento em nuvem e colaboração em tempo real | Bob (Scrum Master) |

## Quick Reference - Key Files and Entry Points

### Critical Files for Understanding the System

- **Main Entry**: `index.html` (a ser criado - ponto de entrada da SPA)
- **Configuration**: Configuração Firebase via JavaScript
- **Core Business Logic**: `app.js` (a ser criado - lógica principal)
- **Data Models**: Coleções Firebase Firestore (restaurants, reviews, duplicates)
- **Key Algorithms**: Cálculo de médias de avaliação, prevenção de duplicatas global

### Enhancement Areas

O projeto está em fase de planejamento com todos os requisitos detalhados nos seguintes documentos:
- `docs/brainstorming-session-results.md` - Resultados de brainstorming
- `docs/project-brief.md` - Briefing completo do projeto
- `README.md` - Requisitos detalhados e especificações

## High Level Architecture

### Technical Summary

Aplicação web single-page com armazenamento em nuvem usando Firebase Firestore. Implementação client-side com backend-as-a-service, permitindo colaboração em tempo real entre todos os usuários.

### Tech Stack (Atualizado)

| Category | Technology | Version | Notes |
|----------|------------|---------|-------|
| Runtime | Browser JavaScript | ES6+ | Vanilla JS, sem frameworks |
| Backend | Firebase Firestore | N/A | Database NoSQL em tempo real |
| Storage | Firebase Storage | N/A | Armazenamento de imagens em nuvem |
| Authentication | Firebase Auth | N/A | Opcional, para identificação de usuários |
| Styling | CSS3 | N/A | Mobile-first, responsive design |
| Images | Firebase Storage | N/A | Upload e otimização automática |
| Security | Firebase Security Rules | N/A | Regras de acesso a dados |
| Offline | Firebase Offline Persistence | N/A | Funcionalidade offline com sync |

### Repository Structure (Planejada)

```
esplanada_eats/
├── index.html              # Página principal (SPA)
├── css/
│   └── style.css           # Estilos principais
├── js/
│   ├── app.js              # Lógica principal da aplicação
│   ├── storage.js          # Gerenciamento de localStorage
│   ├── validation.js       # Validação de formulários
│   ├── ui.js               # Manipulação de UI e modais
│   └── utils.js            # Funções utilitárias
├── docs/                   # Documentação do projeto
├── README.md               # Requisitos e especificações
└── .gitignore              # Arquivos a ignorar no git
```

## Source Tree and Module Organization

### Project Structure (Atual - Planejamento)

O projeto atualmente consiste apenas de documentação. Nenhum código foi implementado ainda.

```
esplanada_eats/
├── docs/                   # Documentação completa
│   ├── brainstorming-session-results.md
│   ├── project-brief.md
│   └── project-architecture.md
├── .bmad-core/            # Framework de desenvolvimento
├── .git/                  # Controle de versão
├── README.md              # Requisitos detalhados
└── web_bundles/           # Recursos de agentes AI
```

### Key Modules and Their Purpose (Planejado)

- **Main Application (`app.js`)**: Orquestração principal, inicialização Firebase, roteamento de modais
- **Firebase Manager (`firebase.js`)**: Configuração e operações Firestore/Storage
- **Storage Manager (`storage.js`)**: CRUD operations para restaurantes e avaliações via Firebase
- **Validation Engine (`validation.js`)**: Validação de formulários, sanitização de inputs
- **UI Controller (`ui.js`)**: Gerenciamento de modais, cards, feedback visual, real-time updates
- **Utils (`utils.js`)**: Funções auxiliares (fingerprinting, otimização de imagens)

## Data Models and APIs

### Data Models

#### Restaurantes (Firebase Collection)
```javascript
{
  id: string,                    // Auto-generated by Firestore
  name: string,                  // Mínimo 4 caracteres
  hours: string,                 // Formato "12h30-18h"
  price: string,                 // "R$ 30-50" ou valor único
  vegetarianOptions: string,    // "Muitas opções", "Algumas", "Poucas", "Nenhuma"
  access: string,                // "Simples", "Médio", "Burocrático"
  description?: string,          // Opcional
  photoUrls?: string[],          // Array de URLs Firebase Storage (max 4)
  averageQuality: number,        // Calculado automaticamente
  averagePrice: number,          // Calculado automaticamente
  totalReviews: number,          // Contador de avaliações
  createdAt: timestamp,           // Firestore timestamp
  updatedAt: timestamp           // Firestore timestamp
}
```

#### Avaliações (Firebase Collection)
```javascript
{
  id: string,                    // Auto-generated by Firestore
  restaurantId: string,          // Referência ao restaurante
  userName: string,              // Nome do avaliador
  userFingerprint: string,       // Hash do navegador + ID único
  quality: number,               // 0-5, meio pontos permitidos
  price: number,                 // 0-5, meio pontos permitidos
  access: string,                // "Simples", "Médio", "Burocrático"
  vegetarianOptions: string,    // "Muitas", "Algumas", "Poucas", "Nenhuma"
  comment?: string,              // Opcional, sanitized
  photoUrls?: string[],          // Opcional, URLs Firebase Storage
  createdAt: timestamp,          // Firestore timestamp
  updatedAt: timestamp           // Firestore timestamp
}
```

#### Controle de Duplicatas (Firebase Collection)
```javascript
{
  restaurantId: string,          // ID do restaurante
  userFingerprint: string,       // Hash único do usuário global
  reviewId: string,              // Referência à avaliação
  createdAt: timestamp,          // Firestore timestamp
  updatedAt: timestamp           // Firestore timestamp
}
```

### Firebase API Specifications

#### Firestore API (Funções Planejadas)
```javascript
// Firebase Configuration
firebase.initializeApp()
firebase.enableOfflinePersistence()

// Restaurantes
firebase.createRestaurant(restaurantData)
firebase.getAllRestaurants() // com real-time listener
firebase.getRestaurant(id)
firebase.updateRestaurant(id, data)
firebase.deleteRestaurant(id)

// Avaliações
firebase.createReview(reviewData)
firebase.getReviewsByRestaurant(restaurantId) // com real-time listener
firebase.getUserReviewsForRestaurant(restaurantId, userFingerprint)
firebase.calculateRestaurantAverages(restaurantId) // Firestore trigger

// Utilitários
firebase.generateUserFingerprint()
firebase.checkDuplicateReview(restaurantId, userFingerprint)
firebase.uploadImage(file, path)
firebase.deleteImage(url)

// Real-time Listeners
firebase.subscribeToRestaurants(callback)
firebase.subscribeToRestaurantReviews(restaurantId, callback)
```

#### UI API (Eventos Planejados)
```javascript
// Modais
ui.showRestaurantModal(restaurantId)
ui.showAddRestaurantModal()
ui.showReviewModal(restaurantId)
ui.closeModal()

// Cards
ui.renderRestaurantCards(restaurants)
ui.updateCardAverage(restaurantId, averages)

// Feedback
ui.showSuccess(message)
ui.showError(message)
ui.showValidationErrors(errors)
```

## Technical Debt and Known Issues

### Current Technical Debt (Pré-Implementação)

1. **Nenhum código implementado**: Todo o sistema precisa ser construído do zero
2. **Dependência total de localStorage**: Dados voláteis, sem backup
3. **Segurança client-side limitada**: Vulnerável a manipulação do navegador
4. **Escalabilidade limitada**: Restrições de 5MB do localStorage
5. **Sem persistência entre dispositivos**: Cada navegador tem dados independentes

### Known Constraints and Limitations

#### Storage Constraints
- **Tamanho máximo**: ~5MB por domínio
- **Volatilidade**: Dados perdidos ao limpar cache
- **Concorrência**: Sem tratamento de acesso simultâneo
- **Backup**: Sem mecanismo automático de backup

#### Security Constraints
- **XSS Protection**: Apenas sanitização básica client-side
- **Data Validation**: Sem validação server-side
- **Authentication**: Sistema baseado em fingerprint (fraco)
- **Authorization**: Sem controle de acesso granular

#### Performance Constraints
- **Large Datasets**: Sem paginação ou lazy loading planejado inicialmente
- **Image Handling**: Processamento client-side pode ser lento
- **Memory Usage**: Todos os dados carregados em memória

## Integration Points and External Dependencies

### External Services

Nenhuma integração externa planejada para o MVP. Sistema completamente standalone.

### Internal Integration Points

#### Module Dependencies (Planejadas)
```
app.js (main)
├── storage.js (data persistence)
├── validation.js (input validation)
├── ui.js (interface management)
└── utils.js (helper functions)
```

#### Data Flow
```
User Input → Validation → Storage → UI Update → User Feedback
```

## Development and Deployment

### Local Development Setup (Planejado)

1. **Requisitos Mínimos**:
   - Navegador moderno com suporte ES6+
   - Servidor local estático (Live Server, Python HTTP server, etc.)
   - Nenhuma dependência de Node.js ou build tools

2. **Setup**:
   ```bash
   # Clonar repositório
   git clone [repository]
   cd esplanada_eats

   # Iniciar servidor local
   python -m http.server 8000
   # ou usar Live Server no VS Code
   ```

3. **Estrutura de Arquivos**:
   - Todos os arquivos em um único diretório
   - Sem build process ou transpilation
   - Desenvolvimento direto no navegador

### Build and Deployment Process

#### Build Process
- **Sem build process**: Arquivos estáticos servidos diretamente
- **Otimização**: Minificação manual de CSS/JS se necessário
- **Bundling**: Cada módulo em arquivo separado

#### Deployment
- **Plataformas**: GitHub Pages, Netlify, Vercel, qualquer hosting estático
- **Domínio**: Opcional, pode usar subdomínio gratuito
- **HTTPS**: Recomendado (disponível gratuitamente na maioria das plataformas)
- **CDN**: Não necessário para MVP

### Environment Configuration

#### Client-side Configuration
```javascript
const config = {
  appName: 'Esplanada Eats',
  version: '1.0.0',
  storageKeys: {
    restaurants: 'esplanada-restaurantes',
    reviews: 'esplanada-avaliacoes',
    duplicates: 'esplanada-duplicatas'
  },
  limits: {
    maxPhotos: 4,
    maxPhotoSize: 2 * 1024 * 1024, // 2MB
    maxStorageWarning: 4 * 1024 * 1024 // 4MB
  }
};
```

## Testing Reality

### Current Test Coverage

- **Unit Tests**: 0% (nenhum código implementado)
- **Integration Tests**: 0%
- **E2E Tests**: 0%
- **Manual Testing**: Será o método principal de QA

### Planned Testing Strategy

#### Manual Testing Checklist
- [ ] Cadastro de restaurante com todos os campos obrigatórios
- [ ] Validação de campos (erros, feedback visual)
- [ ] Upload de imagens (formatos, tamanhos)
- [ ] Sistema de avaliação (prevenção de duplicatas)
- [ ] Cálculo correto de médias
- [ ] Responsividade em diferentes dispositivos
- [ ] Funcionamento em diferentes navegadores
- [ ] Limite de armazenamento do localStorage

#### Browser Compatibility Target
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## If Enhancement PRD Provided - Impact Analysis

### Current Project Status

**Fase**: Planejamento completo, pronto para desenvolvimento
**Próximos Passos**: Implementação do MVP conforme plano no project-brief.md
**Riscos Identificados**: Limitações do localStorage, segurança client-side

### Files That Will Need Creation

Based on the project requirements, these files need to be created:

#### Core Files
- `index.html` - Estrutura principal da SPA
- `css/style.css` - Estilos responsivos
- `js/app.js` - Lógica principal da aplicação
- `js/storage.js` - Gerenciamento de localStorage
- `js/validation.js` - Validação de formulários
- `js/ui.js` - Gerenciamento de interface
- `js/utils.js` - Funções utilitárias

#### Supporting Files
- `.gitignore` - Arquivos a ignorar
- `README.md` - Já existe com requisitos detalhados

### New Modules Needed

#### Storage Module
- CRUD operations para restaurantes
- CRUD operations para avaliações
- Sistema de fingerprint do usuário
- Prevenção de duplicatas
- Cálculo de médias e estatísticas

#### Validation Module
- Validação de campos obrigatórios
- Sanitização de inputs (XSS prevention)
- Validação de upload de imagens
- Formatação de dados

#### UI Module
- Sistema de modais
- Renderização de cards responsivos
- Feedback visual (success/error)
- Galeria de imagens

### Integration Considerations

#### Data Flow Integration
- Comunicação entre modules via eventos ou callbacks
- Sincronização entre UI e storage
- Atualização em tempo real das médias

#### Error Handling Integration
- Tratamento consistente de erros entre modules
- Mensagens de erro amigáveis para o usuário
- Recovery automático onde possível

## Appendix - Useful Commands and Scripts

### Planned Development Commands

#### Setup Commands
```bash
# Criar estrutura de diretórios
mkdir -p css js

# Iniciar servidor local para desenvolvimento
python -m http.server 8000
# ou
npx live-server
```

#### Development Workflow
```bash
# Testar em diferentes navegadores
# Chrome, Firefox, Safari, Edge

# Testar responsividade
# DevTools mobile emulation + dispositivos reais

# Limpar localStorage para testes
# DevTools → Application → Local Storage → Clear
```

### Debugging and Troubleshooting

#### Browser DevTools Usage
- **Console**: Debug de JavaScript e erros
- **Application**: Inspecionar localStorage, cookies
- **Network**: Verificar carregamento de recursos (embora tudo seja local)
- **Elements**: Inspecionar DOM e estilos CSS

#### Common Issues and Solutions
- **LocalStorage cheio**: Limpar dados não essenciais
- **Imagens não carregando**: Verificar formato e tamanho
- **Modais não funcionando**: Verificar event listeners
- **Dados não persistindo**: Verificar quota do localStorage

### Code Conventions (Planejadas)

#### JavaScript Conventions
- ES6+ features (const/let, arrow functions, destructuring)
- CamelCase para variáveis e funções
- PascalCase para classes e construtores
- UPPER_CASE para constantes

#### CSS Conventions
- BEM methodology para nomes de classes
- Mobile-first approach
- CSS custom properties para cores e tamanhos
- Flexbox e Grid para layout

#### HTML Conventions
- Elementos semânticos HTML5
- Atributos ARIA para acessibilidade
- Meta tags para responsive design
- Comments para estruturação

## Success Criteria for Implementation

### MVP Success Metrics
- [ ] Homepage responsiva com cards funcionais
- [ ] Sistema de cadastro de restaurantes completo
- [ ] Sistema de avaliação com prevenção de duplicatas
- [ ] Modal de detalhes com todas as informações
- [ ] Validações e segurança implementadas
- [ ] Funcionamento em múltiplos navegadores
- [ ] Documentação completa e atualizada

### Technical Success Metrics
- Performance aceitável (< 2s para todas as operações)
- Uso eficiente do localStorage (< 80% do limite)
- Não há memory leaks
- Interface usável em mobile
- Dados consistentes e não corrompidos

### User Experience Success Metrics
- Usuários conseguem cadastrar sem ajuda externa
- Fluxo de avaliação intuitivo
- Feedback visual claro para todas as ações
- Interface agradável e profissional

---
*Documentação gerada em 13/09-2025 - Mary (Business Analyst)*