<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Rating Display System (Story 3.5)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            line-height: 1.6;
            background: #f8fafc;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 0.5rem;
        }
        .log {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }
        .btn {
            background: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            cursor: pointer;
            margin: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        .btn.secondary {
            background: #64748b;
        }
        .btn.secondary:hover {
            background: #475569;
        }
        .result {
            background: #e7f3ff;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            border-left: 4px solid #2563eb;
        }
        .error {
            color: #dc3545;
            background: #ffe6e6;
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .success {
            color: #155724;
            background: #e6ffe6;
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        .demo-card {
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
        }
        .demo-card h4 {
            margin: 0 0 1rem 0;
            color: #333;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        .comparison-item {
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .comparison-item h5 {
            margin: 0 0 1rem 0;
            color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåü Teste - Rating Display System (Story 3.5)</h1>
            <p>Teste abrangente do sistema de exibi√ß√£o de avalia√ß√µes com m√∫ltiplos modos e funcionalidades.</p>
        </header>

        <main>
            <!-- Display Modes Test -->
            <section class="test-section">
                <h2>üì± Teste de Modos de Display</h2>
                <button class="btn" onclick="testDisplayModes()">Testar Todos os Modos</button>
                <button class="btn secondary" onclick="testResponsiveDesign()">Testar Responsividade</button>
                <div id="display-modes-result"></div>
            </section>

            <!-- Star Rendering Test -->
            <section class="test-section">
                <h2>‚≠ê Teste de Renderiza√ß√£o de Estrelas</h2>
                <button class="btn" onclick="testStarRendering()">Testar Renderiza√ß√£o de Estrelas</button>
                <button class="btn secondary" onclick="testHalfStarSupport()">Testar Meia Estrela</button>
                <div id="star-rendering-result"></div>
            </section>

            <!-- Statistics Display Test -->
            <section class="test-section">
                <h2>üìä Teste de Estat√≠sticas Avan√ßadas</h2>
                <button class="btn" onclick="testStatisticsDisplay()">Testar Estat√≠sticas</button>
                <button class="btn secondary" onclick="testConfidenceIndicators()">Testar Indicadores de Confian√ßa</button>
                <div id="statistics-result"></div>
            </section>

            <!-- Real-time Updates Test -->
            <section class="test-section">
                <h2>‚ö° Teste de Atualiza√ß√µes em Tempo Real</h2>
                <button class="btn" onclick="testRealtimeUpdates()">Iniciar Teste Real-time</button>
                <button class="btn secondary" onclick="simulateRatingChange()">Simular Mudan√ßa de Rating</button>
                <div id="realtime-result"></div>
            </section>

            <!-- Edge Cases Test -->
            <section class="test-section">
                <h2>üîß Teste de Edge Cases</h2>
                <button class="btn" onclick="testEdgeCases()">Testar Casos Extremos</button>
                <button class="btn secondary" onclick="testErrorStates()">Testar Estados de Erro</button>
                <div id="edge-cases-result"></div>
            </section>

            <!-- Animation Test -->
            <section class="test-section">
                <h2>üé¨ Teste de Anima√ß√µes</h2>
                <button class="btn" onclick="testAnimations()">Testar Anima√ß√µes</button>
                <button class="btn secondary" onclick="testTransitions()">Testar Transi√ß√µes Suaves</button>
                <div id="animation-result"></div>
            </section>

            <!-- Accessibility Test -->
            <section class="test-section">
                <h2>‚ôø Teste de Acessibilidade</h2>
                <button class="btn" onclick="testAccessibility()">Testar Acessibilidade</button>
                <button class="btn secondary" onclick="testScreenReaders()">Testar Suporte a Screen Readers</button>
                <div id="accessibility-result"></div>
            </section>

            <!-- Performance Test -->
            <section class="test-section">
                <h2>üöÄ Teste de Performance</h2>
                <button class="btn" onclick="testPerformance()">Testar Performance</button>
                <button class="btn secondary" onclick="stressTest()">Teste de Carga</button>
                <div id="performance-result"></div>
            </section>
        </main>

        <footer>
            <div class="log" id="main-log">Iniciando testes do Story 3.5...</div>
        </footer>
    </div>

    <!-- Rating Display Component -->
    <script type="module">
        import { RatingDisplay } from './js/components/rating-display.js?v=1.0.1';

        // Make RatingDisplay available globally
        window.RatingDisplay = RatingDisplay;

        // Test data
        const testRestaurants = [
            {
                name: "Restaurante Excelente",
                averageQuality: 4.8,
                totalRatings: 156,
                confidenceScore: 0.95,
                ratingDistribution: { 1: 2, 2: 3, 3: 8, 4: 23, 5: 120 },
                trend: "up"
            },
            {
                name: "Restaurante Mediano",
                averageQuality: 3.2,
                totalRatings: 45,
                confidenceScore: 0.65,
                ratingDistribution: { 1: 8, 2: 12, 3: 15, 4: 8, 5: 2 },
                trend: "neutral"
            },
            {
                name: "Restaurante Novo",
                averageQuality: 0,
                totalRatings: 0,
                confidenceScore: 0,
                ratingDistribution: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },
                trend: "neutral"
            },
            {
                name: "Restaurante Decimal",
                averageQuality: 3.7,
                totalRatings: 23,
                confidenceScore: 0.72,
                ratingDistribution: { 1: 1, 2: 3, 3: 5, 4: 9, 5: 5 },
                trend: "down"
            }
        ];

        const logDiv = document.getElementById('main-log');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function logToDiv(divId, message, type = 'info') {
            const div = document.getElementById(divId);
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            div.innerHTML += `<div class="${type === 'error' ? 'error' : type === 'success' ? 'success' : 'result'}">[${timestamp}] ${prefix} ${message}</div>`;
        }

        // Test functions
        window.testDisplayModes = function() {
            const resultDiv = document.getElementById('display-modes-result');
            resultDiv.innerHTML = '<h3>üì± Modos de Display</h3>';

            const modes = ['compact', 'card', 'detailed', 'modal'];
            let html = '<div class="demo-grid">';

            testRestaurants.forEach(restaurant => {
                html += `<div class="demo-card">`;
                html += `<h4>${restaurant.name}</h4>`;

                modes.forEach(mode => {
                    html += `<div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 4px;">`;
                    html += `<strong>Modo: ${mode}</strong><br>`;
                    const containerId = `${mode}-${restaurant.name.replace(/\s+/g, '-')}`;
                    html += `<div id="${containerId}"></div>`;
                    html += `</div>`;
                });

                html += `</div>`;
            });

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render displays
            setTimeout(() => {
                testRestaurants.forEach(restaurant => {
                    modes.forEach(mode => {
                        const containerId = `${mode}-${restaurant.name.replace(/\s+/g, '-')}`;
                        const container = document.getElementById(containerId);
                        if (container) {
                            const options = { mode };
                            if (mode === 'detailed') {
                                options.showConfidence = true;
                                options.showDistribution = true;
                                options.showTrend = true;
                            }
                            RatingDisplay.render(restaurant, options, container);
                        }
                    });
                });
                log('Modos de display testados com sucesso', 'success');
            }, 100);
        };

        window.testStarRendering = function() {
            const resultDiv = document.getElementById('star-rendering-result');
            resultDiv.innerHTML = '<h3>‚≠ê Renderiza√ß√£o de Estrelas</h3>';

            const ratings = [0, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';

            ratings.forEach(rating => {
                html += '<div style="padding: 1rem; background: #f8f9fa; border-radius: 4px; text-align: center;">';
                html += `<strong>Rating: ${rating}</strong><br>`;
                html += `<div style="margin: 0.5rem 0;"></div>`;
                const containerId = `stars-${rating}`;
                html += `<div id="${containerId}"></div>`;
                html += '</div>';
            });

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render stars
            setTimeout(() => {
                ratings.forEach(rating => {
                    const container = document.getElementById(`stars-${rating}`);
                    if (container) {
                        const display = new RatingDisplay({ mode: 'compact' });
                        display.render({ averageQuality: rating, totalRatings: 10 }, container);
                    }
                });
                log('Renderiza√ß√£o de estrelas testada com sucesso', 'success');
            }, 100);
        };

        window.testResponsiveDesign = function() {
            const resultDiv = document.getElementById('display-modes-result');
            resultDiv.innerHTML = '<h3>üì± Teste de Design Responsivo</h3>';
            resultDiv.innerHTML += '<p>Redimensione a janela do navegador para testar a responsividade dos displays abaixo:</p>';

            const restaurant = testRestaurants[0]; // Excelente restaurant
            const modes = [
                { name: 'Compact (Mobile)', mode: 'compact', description: 'Ideal para cards e listas em dispositivos m√≥veis' },
                { name: 'Card (Tablet)', mode: 'card', description: 'Otimizado para cards de restaurantes' },
                { name: 'Detailed (Desktop)', mode: 'detailed', description: 'Completo com estat√≠sticas avan√ßadas' }
            ];

            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">';

            modes.forEach(modeConfig => {
                html += '<div style="padding: 1rem; border: 1px solid #ddd; border-radius: 8px; background: white;">';
                html += `<h4>${modeConfig.name}</h4>`;
                html += `<p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">${modeConfig.description}</p>`;
                html += `<div style="border: 1px dashed #ccc; padding: 1rem; border-radius: 4px;">`;
                const containerId = `responsive-${modeConfig.mode}`;
                html += `<div id="${containerId}"></div>`;
                html += '</div>';
                html += '</div>';
            });

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render responsive displays
            setTimeout(() => {
                modes.forEach(modeConfig => {
                    const container = document.getElementById(`responsive-${modeConfig.mode}`);
                    if (container) {
                        const options = { mode: modeConfig.mode };
                        if (modeConfig.mode === 'detailed') {
                            options.showConfidence = true;
                            options.showDistribution = true;
                        }
                        RatingDisplay.render(restaurant, options, container);
                    }
                });
                log('Teste de design responsivo iniciado - redimensione a janela', 'success');
            }, 100);
        };

        window.testHalfStarSupport = function() {
            const resultDiv = document.getElementById('star-rendering-result');
            resultDiv.innerHTML = '<h3>‚≠ê Teste de Meia Estrela</h3>';

            const halfStarRatings = [0.5, 1.5, 2.5, 3.5, 4.5];
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">';

            halfStarRatings.forEach(rating => {
                html += '<div style="padding: 1rem; background: #f8f9fa; border-radius: 4px; text-align: center;">';
                html += `<strong>Rating: ${rating}</strong><br>`;
                html += `<small>Meia estrela deve aparecer</small><br>`;
                html += `<div style="margin: 0.5rem 0;"></div>`;
                const containerId = `half-star-${rating}`;
                html += `<div id="${containerId}"></div>`;
                html += '</div>';
            });

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render half stars
            setTimeout(() => {
                halfStarRatings.forEach(rating => {
                    const container = document.getElementById(`half-star-${rating}`);
                    if (container) {
                        const display = new RatingDisplay({ mode: 'compact' });
                        display.render({ averageQuality: rating, totalRatings: 15 }, container);
                    }
                });
                log('Teste de meia estrela conclu√≠do com sucesso', 'success');
            }, 100);
        };

        window.testConfidenceIndicators = function() {
            const resultDiv = document.getElementById('statistics-result');
            resultDiv.innerHTML = '<h3>üìä Indicadores de Confian√ßa</h3>';

            const confidenceLevels = [
                { score: 0.95, label: 'Muito Alto (95%)', color: '#28a745' },
                { score: 0.75, label: 'Alto (75%)', color: '#17a2b8' },
                { score: 0.50, label: 'M√©dio (50%)', color: '#ffc107' },
                { score: 0.25, label: 'Baixo (25%)', color: '#fd7e14' },
                { score: 0.05, label: 'Muito Baixo (5%)', color: '#dc3545' }
            ];

            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';

            confidenceLevels.forEach((confidence, index) => {
                html += '<div style="padding: 1rem; background: #f8f9fa; border-radius: 4px; text-align: center;">';
                html += `<strong>${confidence.label}</strong><br>`;
                html += `<small style="color: ${confidence.color};">‚óè</small><br>`;
                html += `<div style="margin: 0.5rem 0;"></div>`;
                const containerId = `confidence-${index}`;
                html += `<div id="${containerId}"></div>`;
                html += '</div>';
            });

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render confidence indicators
            setTimeout(() => {
                confidenceLevels.forEach((confidence, index) => {
                    const container = document.getElementById(`confidence-${index}`);
                    if (container) {
                        RatingDisplay.render({
                            averageQuality: 4.0,
                            totalRatings: 50,
                            confidenceScore: confidence.score,
                            ratingDistribution: { 1: 2, 2: 5, 3: 10, 4: 18, 5: 15 },
                            trend: 'up'
                        }, {
                            mode: 'detailed',
                            showConfidence: true,
                            showDistribution: false
                        }, container);
                    }
                });
                log('Indicadores de confian√ßa testados com sucesso', 'success');
            }, 100);
        };

        window.simulateRatingChange = function() {
            const resultDiv = document.getElementById('realtime-result');
            resultDiv.innerHTML = '<h3>‚ö° Simula√ß√£o de Mudan√ßa de Rating</h3>';
            resultDiv.innerHTML += '<div id="simulation-display"></div>';
            resultDiv.innerHTML += '<button class="btn" onclick="simulateNextChange()">Pr√≥xima Mudan√ßa</button>';
            resultDiv.innerHTML += '<button class="btn secondary" onclick="resetSimulation()">Resetar</button>';

            let simulationStep = 0;
            const simulationSteps = [
                { rating: 2.5, total: 10, trend: 'down', description: 'Rating Baixo' },
                { rating: 3.2, total: 25, trend: 'up', description: 'Rating Melhorando' },
                { rating: 4.1, total: 45, trend: 'up', description: 'Rating Bom' },
                { rating: 4.8, total: 120, trend: 'up', description: 'Rating Excelente' },
                { rating: 4.5, total: 150, trend: 'down', description: 'Leve Queda' }
            ];

            const display = new RatingDisplay({
                mode: 'detailed',
                showConfidence: true,
                showDistribution: true,
                animated: true
            });

            function renderSimulation() {
                const step = simulationSteps[simulationStep];
                display.render({
                    averageQuality: step.rating,
                    totalRatings: step.total,
                    confidenceScore: Math.min(0.95, step.total / 100),
                    ratingDistribution: {
                        1: Math.max(0, Math.floor(step.total * 0.1)),
                        2: Math.max(0, Math.floor(step.total * 0.15)),
                        3: Math.max(0, Math.floor(step.total * 0.20)),
                        4: Math.max(0, Math.floor(step.total * 0.30)),
                        5: Math.max(0, step.total - Math.floor(step.total * 0.75))
                    },
                    trend: step.trend
                }, document.getElementById('simulation-display'));

                log(`Simula√ß√£o: ${step.description} - Rating: ${step.rating}, Total: ${step.total}`, 'success');
            }

            window.simulateNextChange = function() {
                simulationStep = (simulationStep + 1) % simulationSteps.length;
                renderSimulation();
            };

            window.resetSimulation = function() {
                simulationStep = 0;
                renderSimulation();
                log('Simula√ß√£o resetada', 'info');
            };

            renderSimulation();
            log('Simula√ß√£o de mudan√ßa de rating iniciada', 'success');
        };

        window.testErrorStates = function() {
            const resultDiv = document.getElementById('edge-cases-result');
            resultDiv.innerHTML = '<h3>üîß Estados de Erro</h3>';

            const errorCases = [
                { name: "Dados Corrompidos", data: { averageQuality: "corrupt", totalRatings: "invalid" } },
                { name: "Objeto Vazio", data: {} },
                { name: "Dados Nulos", data: { averageQuality: null, totalRatings: null } },
                { name: "Array Inv√°lido", data: { averageQuality: [1, 2, 3], totalRatings: "array" } },
                { name: "Boolean Inv√°lido", data: { averageQuality: true, totalRatings: false } }
            ];

            let html = '<div class="demo-grid">';
            errorCases.forEach((testCase, index) => {
                html += '<div class="demo-card">';
                html += `<h4>${testCase.name}</h4>`;
                html += `<div style="font-size: 0.75rem; color: #666; margin-bottom: 0.5rem; font-family: monospace;">`;
                html += `Dados: ${JSON.stringify(testCase.data)}`;
                html += `</div>`;
                html += `<div id="error-case-${index}" style="padding: 1rem; background: #f8f9fa; border-radius: 4px;"></div>`;
                html += '</div>';
            });
            html += '</div>';
            resultDiv.innerHTML = html;

            // Test error cases
            setTimeout(() => {
                errorCases.forEach((testCase, index) => {
                    const container = document.getElementById(`error-case-${index}`);
                    if (container) {
                        try {
                            RatingDisplay.renderCompact(testCase.data, container);
                            container.innerHTML += '<div style="margin-top: 0.5rem; color: green; font-size: 0.75rem;">‚úÖ Tratado com sucesso</div>';
                        } catch (error) {
                            container.innerHTML = `<div style="color: red; font-size: 0.875rem;">‚ùå Erro capturado: ${error.message}</div>`;
                        }
                    }
                });
                log('Estados de erro testados com sucesso', 'success');
            }, 100);
        };

        window.testTransitions = function() {
            const resultDiv = document.getElementById('animation-result');
            resultDiv.innerHTML = '<h3>üé¨ Transi√ß√µes Suaves</h3>';
            resultDiv.innerHTML += '<div id="transition-display"></div>';
            resultDiv.innerHTML += '<button class="btn" onclick="playTransition()">Iniciar Transi√ß√£o</button>';
            resultDiv.innerHTML += '<button class="btn secondary" onclick="playMultipleTransitions()">M√∫ltiplas Transi√ß√µes</button>';

            const display = new RatingDisplay({
                mode: 'detailed',
                animated: true,
                showConfidence: true
            });

            display.render({
                averageQuality: 3.0,
                totalRatings: 50,
                confidenceScore: 0.7,
                ratingDistribution: { 1: 5, 2: 8, 3: 15, 4: 17, 5: 5 },
                trend: 'neutral'
            }, document.getElementById('transition-display'));

            window.playTransition = function() {
                const targetRating = 2.0 + Math.random() * 3; // Random between 2.0 and 5.0
                display.update({
                    averageQuality: targetRating,
                    totalRatings: 55 + Math.floor(Math.random() * 20),
                    confidenceScore: 0.7 + Math.random() * 0.3,
                    ratingDistribution: {
                        1: Math.floor(Math.random() * 5),
                        2: Math.floor(Math.random() * 10),
                        3: Math.floor(Math.random() * 15),
                        4: Math.floor(Math.random() * 20),
                        5: Math.floor(Math.random() * 25)
                    },
                    trend: Math.random() > 0.5 ? 'up' : 'down'
                });
                log(`Transi√ß√£o suave para rating: ${targetRating.toFixed(1)}`, 'success');
            };

            window.playMultipleTransitions = function() {
                const ratings = [2.5, 3.0, 3.7, 4.2, 4.8];
                let index = 0;

                const interval = setInterval(() => {
                    if (index >= ratings.length) {
                        clearInterval(interval);
                        log('M√∫ltiplas transi√ß√µes conclu√≠das', 'success');
                        return;
                    }

                    display.update({
                        averageQuality: ratings[index],
                        totalRatings: 50 + index * 10,
                        confidenceScore: 0.6 + index * 0.1,
                        ratingDistribution: {
                            1: Math.max(1, 5 - index),
                            2: Math.max(1, 8 - index),
                            3: 10 + index * 2,
                            4: 15 + index * 3,
                            5: 5 + index * 4
                        },
                        trend: index % 2 === 0 ? 'up' : 'down'
                    });

                    log(`Transi√ß√£o ${index + 1}: Rating ${ratings[index]}`, 'info');
                    index++;
                }, 1000);
            };

            log('Teste de transi√ß√µes suaves iniciado', 'success');
        };

        window.testScreenReaders = function() {
            const resultDiv = document.getElementById('accessibility-result');
            resultDiv.innerHTML = '<h3>‚ôø Teste de Suporte a Screen Readers</h3>';

            const testCases = [
                { name: "Display Compact Acess√≠vel", mode: 'compact', accessible: true },
                { name: "Display Detailed Acess√≠vel", mode: 'detailed', accessible: true, showAll: true },
                { name: "Display N√£o Acess√≠vel", mode: 'compact', accessible: false }
            ];

            let html = '<div class="demo-grid">';
            testCases.forEach((testCase, index) => {
                html += '<div class="demo-card">';
                html += `<h4>${testCase.name}</h4>`;
                html += `<div id="screenreader-${index}"></div>`;
                html += '</div>';
            });
            html += '</div>';
            resultDiv.innerHTML = html;

            setTimeout(() => {
                testCases.forEach((testCase, index) => {
                    const container = document.getElementById(`screenreader-${index}`);
                    if (container) {
                        const options = {
                            mode: testCase.mode,
                            accessible: testCase.accessible
                        };

                        if (testCase.showAll) {
                            options.showConfidence = true;
                            options.showDistribution = true;
                            options.showTrend = true;
                        }

                        const ratingData = {
                            averageQuality: 4.2,
                            totalRatings: 88,
                            confidenceScore: 0.85,
                            ratingDistribution: { 1: 3, 2: 7, 3: 15, 4: 28, 5: 35 },
                            trend: 'up'
                        };

                        RatingDisplay.render(ratingData, options, container);

                        // Check for ARIA attributes
                        setTimeout(() => {
                            const ariaElement = container.querySelector('[role], [aria-label]');
                            if (ariaElement) {
                                const ariaLabel = ariaElement.getAttribute('aria-label');
                                container.innerHTML += `
                                    <div style="margin-top: 1rem; padding: 0.5rem; background: #e6ffe6; border-radius: 4px; font-size: 0.75rem;">
                                        <strong>‚úÖ ARIA Support:</strong><br>
                                        Role: ${ariaElement.getAttribute('role') || 'N/A'}<br>
                                        Aria Label: ${ariaLabel || 'N/A'}
                                    </div>
                                `;
                            } else {
                                container.innerHTML += `
                                    <div style="margin-top: 1rem; padding: 0.5rem; background: #ffe6e6; border-radius: 4px; font-size: 0.75rem;">
                                        <strong>‚ùå ARIA Support:</strong> No accessibility attributes found
                                    </div>
                                `;
                            }
                        }, 100);
                    }
                });
                log('Teste de screen readers conclu√≠do', 'success');
            }, 100);
        };

        window.stressTest = function() {
            const resultDiv = document.getElementById('performance-result');
            resultDiv.innerHTML = '<h3>üöÄ Teste de Carga</h3>';
            resultDiv.innerHTML += '<div id="stress-container"></div>';
            resultDiv.innerHTML += '<button class="btn" onclick="runStressTest()">Iniciar Teste de Carga</button>';

            window.runStressTest = function() {
                const container = document.getElementById('stress-container');
                container.innerHTML = '<p>Executando teste de carga...</p>';

                const startTime = performance.now();
                const numDisplays = 500; // Stress test with 500 displays

                setTimeout(() => {
                    container.innerHTML = '';
                    const fragment = document.createDocumentFragment();

                    for (let i = 0; i < numDisplays; i++) {
                        const wrapper = document.createElement('div');
                        wrapper.style.cssText = 'display: inline-block; margin: 2px; padding: 4px; background: #f8f9fa; border-radius: 2px; font-size: 0.75rem;';

                        const ratingData = {
                            averageQuality: Math.random() * 5,
                            totalRatings: Math.floor(Math.random() * 100),
                            confidenceScore: Math.random()
                        };

                        RatingDisplay.renderCompact(ratingData, wrapper);
                        fragment.appendChild(wrapper);
                    }

                    container.appendChild(fragment);

                    const endTime = performance.now();
                    const totalTime = endTime - startTime;
                    const avgTime = totalTime / numDisplays;

                    const results = document.createElement('div');
                    results.innerHTML = `
                        <div class="result">
                            <strong>Stress Test Results:</strong><br>
                            Displays rendered: ${numDisplays}<br>
                            Total time: ${totalTime.toFixed(2)}ms<br>
                            Average per display: ${avgTime.toFixed(2)}ms<br>
                            Status: ${totalTime < 3000 ? '‚úÖ Excellent' : totalTime < 5000 ? '‚ö†Ô∏è Good' : '‚ùå Needs Optimization'}<br>
                            Memory usage: ${avgTime < 5 ? 'Low' : avgTime < 10 ? 'Medium' : 'High'}
                        </div>
                    `;
                    container.appendChild(results);

                    log(`Stress test completed: ${numDisplays} displays in ${totalTime.toFixed(2)}ms`, 'success');
                }, 100);
            };
        };

        window.testStatisticsDisplay = function() {
            const resultDiv = document.getElementById('statistics-result');
            resultDiv.innerHTML = '<h3>üìä Estat√≠sticas Avan√ßadas</h3>';

            const restaurant = testRestaurants[0]; // Excelente restaurant
            let html = '<div class="demo-grid">';

            html += '<div class="demo-card">';
            html += '<h4>Display Completo com Estat√≠sticas</h4>';
            html += '<div id="stats-complete"></div>';
            html += '</div>';

            html += '<div class="demo-card">';
            html += '<h4>Apenas Indicador de Confian√ßa</h4>';
            html += '<div id="stats-confidence"></div>';
            html += '</div>';

            html += '<div class="demo-card">';
            html += '<h4>Apenas Distribui√ß√£o</h4>';
            html += '<div id="stats-distribution"></div>';
            html += '</div>';

            html += '</div>';
            resultDiv.innerHTML = html;

            // Render statistics
            setTimeout(() => {
                RatingDisplay.renderDetailed(restaurant, document.getElementById('stats-complete'));

                RatingDisplay.render(restaurant, {
                    mode: 'detailed',
                    showStars: true,
                    showCount: true,
                    showConfidence: true,
                    showDistribution: false,
                    showTrend: false
                }, document.getElementById('stats-confidence'));

                RatingDisplay.render(restaurant, {
                    mode: 'detailed',
                    showStars: true,
                    showCount: true,
                    showConfidence: false,
                    showDistribution: true,
                    showTrend: false
                }, document.getElementById('stats-distribution'));

                log('Estat√≠sticas avan√ßadas testadas com sucesso', 'success');
            }, 100);
        };

        window.testRealtimeUpdates = function() {
            const resultDiv = document.getElementById('realtime-result');
            resultDiv.innerHTML = '<h3>‚ö° Atualiza√ß√µes em Tempo Real</h3>';
            resultDiv.innerHTML += '<div id="realtime-display"></div>';
            resultDiv.innerHTML += '<button class="btn" onclick="updateRatingSimulated()">Simular Atualiza√ß√£o</button>';
            resultDiv.innerHTML += '<button class="btn secondary" onclick="incrementRating()">Incrementar Rating</button>';

            let currentRating = 3.0;
            const display = new RatingDisplay({
                mode: 'detailed',
                showConfidence: true,
                showDistribution: true,
                animated: true
            });

            display.render({
                averageQuality: currentRating,
                totalRatings: 50,
                confidenceScore: 0.75,
                ratingDistribution: { 1: 5, 2: 8, 3: 15, 4: 17, 5: 5 },
                trend: 'up'
            }, document.getElementById('realtime-display'));

            window.updateRatingSimulated = function() {
                currentRating = Math.random() * 5;
                display.update({
                    averageQuality: currentRating,
                    totalRatings: 55,
                    confidenceScore: 0.8,
                    ratingDistribution: { 1: 3, 2: 7, 3: 12, 4: 20, 5: 13 },
                    trend: Math.random() > 0.5 ? 'up' : 'down'
                });
                log(`Rating atualizado para ${currentRating.toFixed(1)}`, 'success');
            };

            window.incrementRating = function() {
                currentRating = Math.min(5, currentRating + 0.1);
                display.update({
                    averageQuality: currentRating,
                    totalRatings: 56,
                    confidenceScore: 0.82,
                    ratingDistribution: { 1: 2, 2: 6, 3: 11, 4: 21, 5: 16 },
                    trend: 'up'
                });
                log(`Rating incrementado para ${currentRating.toFixed(1)}`, 'success');
            };

            log('Sistema de atualiza√ß√µes em tempo real iniciado', 'success');
        };

        window.testEdgeCases = function() {
            const resultDiv = document.getElementById('edge-cases-result');
            resultDiv.innerHTML = '<h3>üîß Edge Cases</h3>';

            const edgeCases = [
                { name: "Sem Avalia√ß√µes", averageQuality: 0, totalRatings: 0 },
                { name: "Rating Negativo", averageQuality: -1, totalRatings: 5 },
                { name: "Rating Acima de 5", averageQuality: 6, totalRatings: 3 },
                { name: "Valores Nulos", averageQuality: null, totalRatings: null },
                { name: "Valores Indefinidos", averageQuality: undefined, totalRatings: undefined },
                { name: "String em Rating", averageQuality: "4.5", totalRatings: "10" },
                { name: "Avalia√ß√£o M√≠nima", averageQuality: 1, totalRatings: 1 },
                { name: "Avalia√ß√£o M√°xima", averageQuality: 5, totalRatings: 1000 }
            ];

            let html = '<div class="demo-grid">';
            edgeCases.forEach((testCase, index) => {
                html += '<div class="demo-card">';
                html += `<h4>${testCase.name}</h4>`;
                html += `<div style="font-size: 0.875rem; color: #666; margin-bottom: 0.5rem;">`;
                html += `averageQuality: ${testCase.averageQuality}, totalRatings: ${testCase.totalRatings}`;
                html += `</div>`;
                html += `<div id="edge-case-${index}"></div>`;
                html += '</div>';
            });
            html += '</div>';
            resultDiv.innerHTML = html;

            // Test edge cases
            setTimeout(() => {
                edgeCases.forEach((testCase, index) => {
                    const container = document.getElementById(`edge-case-${index}`);
                    if (container) {
                        try {
                            RatingDisplay.renderCompact(testCase, container);
                        } catch (error) {
                            container.innerHTML = `<div class="error">Erro: ${error.message}</div>`;
                        }
                    }
                });
                log('Edge cases testados com sucesso', 'success');
            }, 100);
        };

        window.testAnimations = function() {
            const resultDiv = document.getElementById('animation-result');
            resultDiv.innerHTML = '<h3>üé¨ Anima√ß√µes</h3>';
            resultDiv.innerHTML += '<div id="animation-display"></div>';
            resultDiv.innerHTML += '<button class="btn" onclick="triggerAnimation()">Disparar Anima√ß√£o</button>';

            const display = new RatingDisplay({
                mode: 'detailed',
                animated: true,
                showConfidence: true
            });

            display.render({
                averageQuality: 4.2,
                totalRatings: 100,
                confidenceScore: 0.9,
                ratingDistribution: { 1: 2, 2: 5, 3: 13, 4: 30, 5: 50 },
                trend: 'up'
            }, document.getElementById('animation-display'));

            window.triggerAnimation = function() {
                const newRating = 3.5 + Math.random() * 1.5;
                display.update({
                    averageQuality: newRating,
                    totalRatings: 105,
                    confidenceScore: 0.85,
                    ratingDistribution: { 1: 3, 2: 6, 3: 15, 4: 32, 5: 49 },
                    trend: Math.random() > 0.5 ? 'up' : 'down'
                });
                log(`Anima√ß√£o disparada com novo rating: ${newRating.toFixed(1)}`, 'success');
            };

            log('Sistema de anima√ß√µes testado com sucesso', 'success');
        };

        window.testAccessibility = function() {
            const resultDiv = document.getElementById('accessibility-result');
            resultDiv.innerHTML = '<h3>‚ôø Acessibilidade</h3>';

            const testCases = [
                { name: "Display Acess√≠vel Padr√£o", options: { accessible: true } },
                { name: "Display N√£o Acess√≠vel", options: { accessible: false } },
                { name: "Display Compacto Acess√≠vel", options: { mode: 'compact', accessible: true } }
            ];

            let html = '<div class="demo-grid">';
            testCases.forEach((testCase, index) => {
                html += '<div class="demo-card">';
                html += `<h4>${testCase.name}</h4>`;
                html += `<div id="accessibility-${index}"></div>`;
                html += '</div>';
            });
            html += '</div>';
            resultDiv.innerHTML = html;

            // Test accessibility
            setTimeout(() => {
                testCases.forEach((testCase, index) => {
                    const container = document.getElementById(`accessibility-${index}`);
                    if (container) {
                        const ratingData = {
                            averageQuality: 4.0,
                            totalRatings: 75,
                            confidenceScore: 0.8,
                            ratingDistribution: { 1: 5, 2: 8, 3: 12, 4: 25, 5: 25 },
                            trend: 'up'
                        };

                        const display = RatingDisplay.render(ratingData, testCase.options, container);

                        // Check ARIA attributes
                        const hasAria = container.querySelector('[role="img"], [aria-label]');
                        const ariaStatus = hasAria ? '‚úÖ ARIA attributes present' : '‚ùå ARIA attributes missing';

                        container.innerHTML += `<div style="margin-top: 1rem; font-size: 0.875rem; color: #666;">${ariaStatus}</div>`;
                    }
                });
                log('Testes de acessibilidade conclu√≠dos', 'success');
            }, 100);
        };

        window.testPerformance = function() {
            const resultDiv = document.getElementById('performance-result');
            resultDiv.innerHTML = '<h3>üöÄ Performance</h3>';
            resultDiv.innerHTML += '<div id="performance-container"></div>';

            const startTime = performance.now();
            const container = document.getElementById('performance-container');

            // Test rendering multiple displays
            const fragment = document.createDocumentFragment();

            for (let i = 0; i < 100; i++) {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'margin: 0.5rem 0; padding: 0.5rem; background: #f8f9fa; border-radius: 4px;';

                const ratingData = {
                    averageQuality: Math.random() * 5,
                    totalRatings: Math.floor(Math.random() * 200),
                    confidenceScore: Math.random(),
                    ratingDistribution: {
                        1: Math.floor(Math.random() * 10),
                        2: Math.floor(Math.random() * 15),
                        3: Math.floor(Math.random() * 20),
                        4: Math.floor(Math.random() * 25),
                        5: Math.floor(Math.random() * 30)
                    }
                };

                RatingDisplay.renderCompact(ratingData, wrapper);
                fragment.appendChild(wrapper);
            }

            container.appendChild(fragment);

            const endTime = performance.now();
            const renderTime = endTime - startTime;

            const performanceInfo = document.createElement('div');
            performanceInfo.innerHTML = `
                <div class="result">
                    <strong>Performance Results:</strong><br>
                    Rendered 100 rating displays in ${renderTime.toFixed(2)}ms<br>
                    Average per display: ${(renderTime / 100).toFixed(2)}ms<br>
                    Status: ${renderTime < 1000 ? '‚úÖ Excellent' : renderTime < 2000 ? '‚ö†Ô∏è Good' : '‚ùå Needs Optimization'}
                </div>
            `;
            container.appendChild(performanceInfo);

            log(`Performance test completed: ${renderTime.toFixed(2)}ms for 100 displays`, 'success');
        };

        // Initialize on page load
        window.addEventListener('load', () => {
            log('RatingDisplay test page loaded successfully');
            log('Click the test buttons to validate each feature');

            // Auto-run basic test
            setTimeout(() => {
                testDisplayModes();
            }, 1000);
        });

        // Make log functions available globally
        window.logToDiv = logToDiv;
        window.log = log;
    </script>
</body>
</html>