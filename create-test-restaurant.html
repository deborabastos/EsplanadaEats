<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Restaurante de Teste</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }
        .btn:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è Criar Restaurante de Teste</h1>

        <div>
            <button class="btn" onclick="createTestRestaurant()">Criar Restaurante Teste</button>
            <button class="btn" onclick="createMultipleRestaurants()">Criar V√°rios Restaurantes</button>
            <button class="btn" onclick="createTestRating()">Criar Avalia√ß√£o Teste</button>
            <button class="btn" onclick="location.href='/'">Voltar ao App</button>
        </div>

        <div id="log" class="log">Aguardando a√ß√£o...</div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="src/firebase-config.js?v=2.1.0"></script>

    <script type="module">
        import { StorageService } from './js/services/storage-service.js?v=2.1.0';

        const logDiv = document.getElementById('log');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.createTestRestaurant = async function() {
            try {
                log('üçΩÔ∏è Criando restaurante de teste...');

                if (!window.EsplanadaEatsFirebase || !window.EsplanadaEatsFirebase.firebase) {
                    throw new Error('Firebase n√£o inicializado');
                }

                const storageService = new StorageService(window.EsplanadaEatsFirebase.firebase);

                const restaurantData = {
                    name: 'Restaurante Teste - Esplanada',
                    description: 'Um restaurante delicioso na Esplanada dos Minist√©rios para testar o sistema',
                    address: 'Esplanada dos Minist√©rios, Bras√≠lia - DF',
                    phone: '(61) 9999-8888',
                    category: 'Comida Brasileira',
                    price: 2, // Pre√ßo m√©dio ($$)
                    averageQuality: 4.2, // Avalia√ß√£o inicial
                    totalRatings: 1,
                    photoUrl: 'https://via.placeholder.com/300x200/4CAF50/FFFFFF?text=Restaurante+Teste',
                    ratingDistribution: {
                        5: 1,
                        4: 0,
                        3: 0,
                        2: 0,
                        1: 0
                    },
                    confidenceScore: 1.0,
                    weightedAverage: 4.2,
                    standardDeviation: 0.0,
                    median: 5,
                    mode: 5,
                    ratingLastUpdated: new Date().toISOString(),
                    createdAt: new Date(),
                    updatedAt: new Date()
                };

                const restaurantId = await storageService.createRestaurant(restaurantData);
                log(`‚úÖ Restaurante criado com sucesso! ID: ${restaurantId}`, 'success');
                log(`üìä Nome: ${restaurantData.name}`);
                log(`üí∞ Pre√ßo: ${'$'.repeat(restaurantData.price)} (${restaurantData.price}/5)`);
                log(`‚≠ê Avalia√ß√£o: ${restaurantData.averageQuality}/5 (${restaurantData.totalRatings} avalia√ß√µes)`);

            } catch (error) {
                log(`‚ùå Erro ao criar restaurante: ${error.message}`, 'error');
            }
        };

        window.createMultipleRestaurants = async function() {
            try {
                log('üçΩÔ∏è Criando m√∫ltiplos restaurantes de teste...');

                if (!window.EsplanadaEatsFirebase || !window.EsplanadaEatsFirebase.firebase) {
                    throw new Error('Firebase n√£o inicializado');
                }

                const storageService = new StorageService(window.EsplanadaEatsFirebase.firebase);

                const restaurants = [
                    {
                        name: 'Cantinho da Esplanada',
                        description: 'Comida caseira e aconchegante no cora√ß√£o da Esplanada',
                        address: 'Setor Comercial Sul, Bras√≠lia - DF',
                        phone: '(61) 3333-1111',
                        category: 'Comida Brasileira',
                        price: 2,
                        averageQuality: 4.5,
                        totalRatings: 12,
                        photoUrl: 'https://via.placeholder.com/300x200/FF6B6B/FFFFFF?text=Cantinho+da+Esplanada'
                    },
                    {
                        name: 'Sabor Mineiro',
                        description: 'O melhor da culin√°ria mineira em Bras√≠lia',
                        address: 'Setor de Clubes Esportivos Sul, Bras√≠lia - DF',
                        phone: '(61) 3333-2222',
                        category: 'Comida Mineira',
                        price: 3,
                        averageQuality: 4.8,
                        totalRatings: 8,
                        photoUrl: 'https://via.placeholder.com/300x200/4ECDC4/FFFFFF?text=Sabor+Mineiro'
                    },
                    {
                        name: 'Expresso da Esplanada',
                        description: 'Caf√© r√°pido e delicioso para quem trabalha na √°rea',
                        address: 'Esplanada dos Minist√©rios, Lote 2, Bras√≠lia - DF',
                        phone: '(61) 3333-3333',
                        category: 'Caf√©',
                        price: 1,
                        averageQuality: 3.9,
                        totalRatings: 25,
                        photoUrl: 'https://via.placeholder.com/300x200/FFD93D/000000?text=Expresso+da+Esplanada'
                    }
                ];

                for (let i = 0; i < restaurants.length; i++) {
                    const restaurant = restaurants[i];
                    log(`üìä Criando restaurante ${i + 1}/${restaurants.length}: ${restaurant.name}`);

                    const restaurantData = {
                        ...restaurant,
                        ratingDistribution: {
                            5: Math.floor(Math.random() * restaurant.totalRatings),
                            4: Math.floor(Math.random() * restaurant.totalRatings),
                            3: Math.floor(Math.random() * restaurant.totalRatings),
                            2: Math.floor(Math.random() * restaurant.totalRatings),
                            1: Math.floor(Math.random() * restaurant.totalRatings)
                        },
                        confidenceScore: Math.min(1.0, restaurant.totalRatings / 10),
                        weightedAverage: restaurant.averageQuality,
                        standardDeviation: Math.random() * 0.5 + 0.3,
                        median: Math.floor(restaurant.averageQuality),
                        mode: Math.floor(restaurant.averageQuality),
                        ratingLastUpdated: new Date().toISOString(),
                        createdAt: new Date(),
                        updatedAt: new Date()
                    };

                    try {
                        const restaurantId = await storageService.createRestaurant(restaurantData);
                        log(`‚úÖ ${restaurant.name} criado! ID: ${restaurantId}`, 'success');
                    } catch (error) {
                        log(`‚ùå Erro ao criar ${restaurant.name}: ${error.message}`, 'error');
                    }
                }

                log('üéâ Cria√ß√£o de m√∫ltiplos restaurantes conclu√≠da!', 'success');

            } catch (error) {
                log(`‚ùå Erro ao criar restaurantes: ${error.message}`, 'error');
            }
        };

        window.createTestRating = async function() {
            try {
                log('‚≠ê Criando avalia√ß√£o de teste...');

                if (!window.EsplanadaEatsFirebase || !window.EsplanadaEatsFirebase.firebase) {
                    throw new Error('Firebase n√£o inicializado');
                }

                const storageService = new StorageService(window.EsplanadaEatsFirebase.firebase);

                // First get a restaurant to rate
                const restaurants = await storageService.getRestaurants({ limit: 1 });

                if (restaurants.length === 0) {
                    log('‚ùå Nenhum restaurante encontrado. Crie um restaurante primeiro.', 'error');
                    return;
                }

                const restaurant = restaurants[0];
                log(`üìä Avaliando restaurante: ${restaurant.name}`);

                const ratingData = {
                    restaurantId: restaurant.id,
                    rating: 5,
                    quality: 5,
                    userName: 'Usu√°rio Teste',
                    userFingerprint: 'test-fingerprint-' + Date.now(),
                    comment: 'Excelente restaurante! Recomendo muito.',
                    moderationStatus: 'approved',
                    isReported: false,
                    createdAt: new Date(),
                    updatedAt: new Date()
                };

                const ratingId = await storageService.createRating(ratingData);
                log(`‚úÖ Avalia√ß√£o criada com sucesso! ID: ${ratingId}`, 'success');
                log(`üìä Avalia√ß√£o: ${ratingData.rating}/5 para ${restaurant.name}`);

                // Update restaurant average
                await storageService.updateRestaurantAverageRating(restaurant.id);
                log('‚úÖ M√©dia do restaurante atualizada', 'success');

            } catch (error) {
                log(`‚ùå Erro ao criar avalia√ß√£o: ${error.message}`, 'error');
            }
        };

        // Initialize
        log('üöÄ Ferramenta de cria√ß√£o de testes carregada');
        log('üìã Use os bot√µes para criar restaurantes e avalia√ß√µes de teste');
    </script>
</body>
</html>