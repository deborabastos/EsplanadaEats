<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Real-time Simplificado</title>
    <meta name="description" content="Vers√£o simplificada para testar real-time">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../src/styles.css">

    <!-- Firebase Configuration (embedded) -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBL8Juo6PJQtFJx1KoJU7KGlc_OndCF3Ls",
            authDomain: "esplanada-eats.firebaseapp.com",
            projectId: "esplanada-eats",
            storageBucket: "esplanada-eats.firebasestorage.app",
            messagingSenderId: "403394772779",
            appId: "1:403394772779:web:8db461c61fc21f9e418f6e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize services
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();

        // Database references
        const restaurantsRef = db.collection('restaurants');
        const reviewsRef = db.collection('reviews');

        // Enable offline persistence
        db.enablePersistence({ synchronizeTabs: true })
            .then(() => {
                console.log('‚úÖ Firestore offline persistence enabled');
                updateConnectionStatus(true);
            })
            .catch(err => {
                console.error('‚ùå Persistence error:', err);
                updateConnectionStatus(false);
            });

        // Global variables for real-time data
        let restaurantListener = null;
        let reviewListeners = new Map();
        let currentRestaurants = [];
        let currentReviews = [];

        // Connection status update
        function updateConnectionStatus(isOnline) {
            const statusElement = document.getElementById('connection-status');
            const statusText = document.getElementById('connection-status-text');
            const connectionIndicator = document.getElementById('connection-indicator');
            const stateText = document.getElementById('state-text');

            if (statusElement && statusText) {
                if (isOnline) {
                    statusElement.className = 'alert alert-success text-center';
                    statusText.textContent = '‚úÖ Conectado ao Firebase';
                } else {
                    statusElement.className = 'alert alert-warning text-center';
                    statusText.textContent = '‚ö†Ô∏è Offline - Modo offline ativado';
                }
            }

            if (connectionIndicator) {
                connectionIndicator.textContent = isOnline ? 'üü¢ Online' : 'üü° Offline';
            }

            if (stateText) {
                stateText.textContent = isOnline ? 'Online' : 'Offline';
            }
        }

        // Simple real-time restaurant listener
        function setupRestaurantListener() {
            console.log('üîÑ Setting up restaurant listener...');

            if (restaurantListener) {
                restaurantListener(); // Unsubscribe existing
            }

            restaurantListener = restaurantsRef
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    console.log('üìä Restaurant snapshot received:', snapshot.size);
                    handleRestaurantUpdates(snapshot);
                    updateRestaurantCount();
                }, (error) => {
                    console.error('‚ùå Restaurant listener error:', error);
                    document.getElementById('restaurant-count').textContent = `‚ùå Erro: ${error.message}`;
                });

            return restaurantListener;
        }

        // Handle restaurant updates
        function handleRestaurantUpdates(snapshot) {
            const changes = snapshot.docChanges();
            console.log(`üîÑ Processing ${changes.length} restaurant changes`);

            changes.forEach(change => {
                const restaurant = {
                    id: change.doc.id,
                    ...change.doc.data()
                };

                switch (change.type) {
                    case 'added':
                        currentRestaurants.push(restaurant);
                        addRestaurantToUI(restaurant);
                        updateRestaurantSelect(restaurant, 'add');
                        break;
                    case 'modified':
                        const index = currentRestaurants.findIndex(r => r.id === restaurant.id);
                        if (index !== -1) {
                            currentRestaurants[index] = restaurant;
                            updateRestaurantInUI(restaurant);
                        }
                        break;
                    case 'removed':
                        currentRestaurants = currentRestaurants.filter(r => r.id !== restaurant.id);
                        removeRestaurantFromUI(restaurant.id);
                        updateRestaurantSelect(restaurant, 'remove');
                        break;
                }
            });

            logActivity(`üìä Restaurant updates: ${changes.length} changes processed`);
        }

        // Add restaurant to UI
        function addRestaurantToUI(restaurant) {
            const container = document.getElementById('realtime-restaurants');
            if (!container) return;

            const restaurantDiv = document.createElement('div');
            restaurantDiv.id = `restaurant-${restaurant.id}`;
            restaurantDiv.className = 'restaurant-item alert alert-success mb-2';
            restaurantDiv.style.animation = 'slideIn 0.5s ease-out';

            const rating = restaurant.averageQuality || 0;
            const stars = '‚≠ê'.repeat(Math.floor(rating)) + (rating % 1 >= 0.5 ? 'üåü' : '');

            restaurantDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <strong>${restaurant.name}</strong>
                        <div class="small">
                            ${restaurant.price || 'N/A'} | ${restaurant.vegetarianOptions || 'N/A'} | ${restaurant.access || 'N/A'}
                        </div>
                        <div class="small text-muted">
                            ${stars} (${rating.toFixed(1)}/5) | ${restaurant.totalRatings || 0} avalia√ß√µes
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-success">Novo</div>
                        <div class="small text-muted">${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
            `;

            container.insertBefore(restaurantDiv, container.firstChild);

            // Keep only last 10 restaurants visible
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // Update restaurant in UI
        function updateRestaurantInUI(restaurant) {
            const element = document.getElementById(`restaurant-${restaurant.id}`);
            if (element) {
                element.className = 'restaurant-item alert alert-warning mb-2';
                element.querySelector('.badge').textContent = 'Atualizado';
                element.querySelector('.text-end .small').textContent = new Date().toLocaleTimeString();
            }
        }

        // Remove restaurant from UI
        function removeRestaurantFromUI(restaurantId) {
            const element = document.getElementById(`restaurant-${restaurantId}`);
            if (element) {
                element.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => element.remove(), 500);
            }
        }

        // Update restaurant select dropdown
        function updateRestaurantSelect(restaurant, action) {
            const select = document.getElementById('review-restaurant');
            if (!select) return;

            if (action === 'add') {
                const option = document.createElement('option');
                option.value = restaurant.id;
                option.textContent = restaurant.name;
                select.appendChild(option);
            } else if (action === 'remove') {
                const option = select.querySelector(`option[value="${restaurant.id}"]`);
                if (option) option.remove();
            }
        }

        // Update restaurant count
        function updateRestaurantCount() {
            const countElement = document.getElementById('restaurant-count');
            if (countElement) {
                countElement.textContent = `üçΩÔ∏è ${currentRestaurants.length} restaurantes`;
            }
            const listenerCheckbox = document.getElementById('restaurant-listener');
            if (listenerCheckbox) {
                listenerCheckbox.checked = true;
            }
        }

        // Setup review listener for specific restaurant
        function setupReviewListener(restaurantId) {
            console.log(`üîÑ Setting up review listener for restaurant: ${restaurantId}`);

            // Remove existing listener for this restaurant
            if (reviewListeners.has(restaurantId)) {
                reviewListeners.get(restaurantId)();
                console.log(`üîÑ Removed existing listener for restaurant ${restaurantId}`);
            }

            const listener = reviewsRef
                .where('restaurantId', '==', restaurantId)
                .limit(20)  // Get more recent reviews locally
                .onSnapshot((snapshot) => {
                    console.log(`üìù Review snapshot for restaurant ${restaurantId}:`, snapshot.size, 'reviews');
                    console.log('üìù Review docs:', snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    handleReviewUpdates(snapshot, restaurantId);
                    updateReviewCount();
                }, (error) => {
                    console.error('‚ùå Review listener error:', error);
                    // Show error in UI
                    const container = document.getElementById('realtime-reviews');
                    if (container) {
                        container.innerHTML = `<div class="alert alert-danger">‚ùå Erro ao carregar avalia√ß√µes: ${error.message}</div>`;
                    }
                });

            reviewListeners.set(restaurantId, listener);
            console.log(`‚úÖ Review listener setup complete for restaurant ${restaurantId}`);
            return listener;
        }

        // Handle review updates
        function handleReviewUpdates(snapshot, restaurantId) {
            const reviews = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));

            console.log(`üìù Processing ${reviews.length} reviews for restaurant ${restaurantId}`);

            // Sort reviews by createdAt locally (newest first)
            const sortedReviews = reviews.sort((a, b) => {
                const timeA = a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt);
                const timeB = b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt);
                return timeB - timeA; // Newest first
            });

            // Keep only the 10 most recent reviews
            currentReviews = sortedReviews.slice(0, 10);

            // Update UI
            const container = document.getElementById('realtime-reviews');
            if (container) {
                container.innerHTML = '';

                if (currentReviews.length === 0) {
                    container.innerHTML = '<div class="text-center text-muted">Nenhuma avalia√ß√£o ainda</div>';
                    console.log(`üìù No reviews found for restaurant ${restaurantId}`);
                } else {
                    currentReviews.forEach(review => {
                        const reviewDiv = document.createElement('div');
                        reviewDiv.className = 'alert alert-info mb-2';
                        reviewDiv.style.animation = 'slideIn 0.5s ease-out';
                        reviewDiv.innerHTML = `
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${review.userName}</strong>
                                    <div>‚≠ê ${review.quality}/5 - üí∞ ${review.price}/5</div>
                                    <div class="small">${review.comment || 'Sem coment√°rio'}</div>
                                </div>
                                <div class="text-end">
                                    <div class="small text-muted">${new Date(review.createdAt.toDate ? review.createdAt.toDate() : review.createdAt).toLocaleString()}</div>
                                </div>
                            </div>
                        `;
                        container.appendChild(reviewDiv);
                    });
                    console.log(`üìù Displayed ${currentReviews.length} reviews for restaurant ${restaurantId}`);
                }
            }

            // Update restaurant rating using all reviews (not just the displayed ones)
            if (reviews.length > 0) {
                updateRestaurantRating(restaurantId, reviews);
            }

            logActivity(`üìù Updated ${currentReviews.length} reviews for restaurant ${restaurantId}`);
        }

        // Update restaurant rating based on reviews
        async function updateRestaurantRating(restaurantId, reviews) {
            if (reviews.length === 0) return;

            const totalQuality = reviews.reduce((sum, review) => sum + review.quality, 0);
            const averageQuality = totalQuality / reviews.length;

            try {
                await restaurantsRef.doc(restaurantId).update({
                    averageQuality: Math.round(averageQuality * 10) / 10,
                    totalRatings: reviews.length,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                console.log(`üìä Updated rating for restaurant ${restaurantId}: ${averageQuality.toFixed(1)}/5 (${reviews.length} reviews)`);
            } catch (error) {
                console.error('‚ùå Failed to update restaurant rating:', error);
            }
        }

        // Update review count
        function updateReviewCount() {
            const countElement = document.getElementById('review-count');
            if (countElement) {
                if (currentReviews.length === 0 && !document.getElementById('review-restaurant').value) {
                    countElement.textContent = 'üîÑ Selecione um restaurante';
                } else {
                    countElement.textContent = `‚≠ê ${currentReviews.length} avalia√ß√µes`;
                }
            }
            const listenerCheckbox = document.getElementById('review-listener');
            if (listenerCheckbox) {
                listenerCheckbox.checked = document.getElementById('review-restaurant').value ? true : false;
            }
        }

        // Add restaurant function
        async function addRestaurantRealtime() {
            const name = document.getElementById('restaurant-name').value.trim();
            const price = document.getElementById('restaurant-price').value;

            if (!name) {
                showTestResult('restaurant-test-result', '‚ö†Ô∏è Digite o nome do restaurante', 'warning');
                return;
            }

            const restaurantData = {
                name: name,
                hours: '12h00-23h00',
                price: price,
                vegetarianOptions: 'Algumas',
                access: 'Simples',
                description: `Restaurant added via real-time test at ${new Date().toLocaleTimeString()}`,
                averageQuality: 0,
                totalRatings: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                const docRef = await restaurantsRef.add(restaurantData);
                showTestResult('restaurant-test-result', `‚úÖ Restaurante "${name}" adicionado!`, 'success');
                document.getElementById('restaurant-name').value = '';
                logActivity(`‚úÖ Restaurant added: ${name} (ID: ${docRef.id})`);
            } catch (error) {
                showTestResult('restaurant-test-result', `‚ùå Erro: ${error.message}`, 'error');
                logActivity(`‚ùå Failed to add restaurant: ${error.message}`);
            }
        }

        // Add review function
        async function addReviewRealtime() {
            const restaurantId = document.getElementById('review-restaurant').value;
            const quality = parseFloat(document.getElementById('review-quality').value);
            const userName = document.getElementById('review-user').value.trim();

            console.log('üìù Adding review:', { restaurantId, quality, userName });

            if (!restaurantId || !quality || !userName) {
                showTestResult('review-test-result', '‚ö†Ô∏è Preencha todos os campos', 'warning');
                console.log('‚ùå Missing required fields');
                return;
            }

            const reviewData = {
                restaurantId: restaurantId,
                userName: userName,
                userFingerprint: 'test-fingerprint-' + Date.now(),
                quality: quality,
                price: quality * 0.8,
                access: 'Simples',
                vegetarianOptions: 'Algumas',
                comment: `Real-time test review by ${userName} at ${new Date().toLocaleTimeString()}`,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            console.log('üìù Review data:', reviewData);

            try {
                const docRef = await reviewsRef.add(reviewData);
                console.log('‚úÖ Review added successfully:', docRef.id);
                showTestResult('review-test-result', `‚úÖ Avalia√ß√£o adicionada! (ID: ${docRef.id})`, 'success');
                document.getElementById('review-quality').value = '';
                document.getElementById('review-user').value = '';
                logActivity(`‚úÖ Review added: ${userName} rated ${quality}/5 for restaurant ${restaurantId}`);
            } catch (error) {
                console.error('‚ùå Failed to add review:', error);
                showTestResult('review-test-result', `‚ùå Erro: ${error.message}`, 'error');
                logActivity(`‚ùå Failed to add review: ${error.message}`);
            }
        }

        // Test connection
        function checkConnection() {
            const testRef = db.collection('connection-tests').doc('ping-' + Date.now());
            testRef.set({
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                test: true
            })
            .then(() => {
                showTestResult('restaurant-test-result', '‚úÖ Conex√£o Firebase OK!', 'success');
                logActivity('‚úÖ Firebase connection test successful');
            })
            .catch((error) => {
                showTestResult('restaurant-test-result', `‚ùå Erro de conex√£o: ${error.message}`, 'error');
                logActivity(`‚ùå Firebase connection test failed: ${error.message}`);
            });
        }

        // Load initial data
        async function loadInitialData() {
            try {
                console.log('üîÑ Loading initial data...');

                // Load restaurants
                const restaurantSnapshot = await restaurantsRef.get();
                currentRestaurants = restaurantSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Populate UI
                currentRestaurants.forEach(restaurant => {
                    addRestaurantToUI(restaurant);
                    updateRestaurantSelect(restaurant, 'add');
                });

                updateRestaurantCount();
                console.log(`üìä Loaded ${currentRestaurants.length} restaurants`);

                // Setup real-time listener
                setupRestaurantListener();

                // Initialize review count
                updateReviewCount();

                logActivity(`‚úÖ Initial data loaded: ${currentRestaurants.length} restaurants`);

            } catch (error) {
                console.error('‚ùå Failed to load initial data:', error);
                logActivity(`‚ùå Failed to load initial data: ${error.message}`);
                document.getElementById('restaurant-count').textContent = `‚ùå Erro: ${error.message}`;
            }
        }

        // Utility functions
        function showTestResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (!element) return;

            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };

            element.innerHTML = `<div style="color: ${colors[type]}; font-weight: bold;">${message}</div>`;
        }

        function logActivity(message) {
            const logDiv = document.getElementById('activity-log');
            if (!logDiv) return;

            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '2px';
            logEntry.innerHTML = `<small>[${timestamp}] ${message}</small>`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearActivityLog() {
            const logDiv = document.getElementById('activity-log');
            if (logDiv) {
                logDiv.innerHTML = '';
                logActivity('üßπ Activity log cleared');
            }
        }

        // Restaurant selection change handler
        function onRestaurantSelectChange() {
            const restaurantId = document.getElementById('review-restaurant').value;
            const selectElement = document.getElementById('review-restaurant');
            const reviewSection = document.querySelector('#realtime-reviews').closest('.card');

            if (restaurantId) {
                // Get restaurant name for better logging
                const restaurantName = selectElement.options[selectElement.selectedIndex].text;
                setupReviewListener(restaurantId);
                logActivity(`üîÑ Selected restaurant "${restaurantName}" for review monitoring`);

                // Highlight the review section
                if (reviewSection) {
                    reviewSection.style.border = '2px solid #28a745';
                    reviewSection.style.boxShadow = '0 0 10px rgba(40, 167, 69, 0.3)';
                }
            } else {
                // Clear reviews when no restaurant is selected
                currentReviews = [];
                const container = document.getElementById('realtime-reviews');
                if (container) {
                    container.innerHTML = '<div class="text-center text-muted">üîÑ Selecione um restaurante acima</div>';
                }
                updateReviewCount();
                logActivity('üîÑ Cleared review selection');

                // Remove highlight from review section
                if (reviewSection) {
                    reviewSection.style.border = '';
                    reviewSection.style.boxShadow = '';
                }
            }
        }

        // Monitor online/offline status
        window.addEventListener('online', () => {
            updateConnectionStatus(true);
            logActivity('üü¢ Online status detected');
        });

        window.addEventListener('offline', () => {
            updateConnectionStatus(false);
            logActivity('üü° Offline status detected');
        });

        // Initialize on page load
        window.addEventListener('load', () => {
            console.log('üöÄ Real-time test page loaded');
            logActivity('üöÄ Initializing real-time test page...');

            // Update initial connection status
            updateConnectionStatus(navigator.onLine);

            // Load initial data and setup listeners
            loadInitialData();

            // Update performance metrics
            updateDetailedStatus();

            logActivity('‚úÖ Real-time test page initialized');
        });

        function updateDetailedStatus() {
            document.getElementById('state-text').textContent = navigator.onLine ? 'Online' : 'Offline';
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }

        // Update status every second
        setInterval(updateDetailedStatus, 1000);

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(-100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }

            .restaurant-item {
                transition: all 0.3s ease;
            }
        `;
        document.head.appendChild(style);

        console.log('üöÄ Simplified Real-time Test Script Loaded');
    </script>
</head>
<body>
    <div class="container">
        <header class="text-center py-4">
            <h1>‚ö° Test: Real-time Simplificado</h1>
            <p class="lead">Vers√£o simplificada para testar sincroniza√ß√£o em tempo real</p>
        </header>

        <!-- Connection Status -->
        <div id="connection-status" class="alert alert-info text-center">
            <span id="connection-status-text">Inicializando Firebase...</span>
        </div>

        <main>
            <!-- Real-time Status -->
            <section class="my-4">
                <h2>Status em Tempo Real</h2>
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Conex√£o</h5>
                            </div>
                            <div class="card-body">
                                <div id="connection-indicator">üîÑ Verificando...</div>
                                <button class="btn btn-sm btn-outline-primary mt-2" onclick="checkConnection()">
                                    Testar Conex√£o
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Restaurantes</h5>
                            </div>
                            <div class="card-body">
                                <div id="restaurant-count">üîÑ Carregando...</div>
                                <div class="form-check mt-2">
                                    <input type="checkbox" id="restaurant-listener" class="form-check-input" disabled>
                                    <label for="restaurant-listener" class="form-check-label">Listener ativo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Avalia√ß√µes</h5>
                            </div>
                            <div class="card-body">
                                <div id="review-count">üîÑ Carregando...</div>
                                <div class="form-check mt-2">
                                    <input type="checkbox" id="review-listener" class="form-check-input" disabled>
                                    <label for="review-listener" class="form-check-label">Listener ativo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Status Detalhado</h5>
                            </div>
                            <div class="card-body">
                                <div id="detailed-status">
                                    <div>Estado: <span id="state-text">Verificando...</span></div>
                                    <div>√öltima atualiza√ß√£o: <span id="last-update">Nunca</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-time Restaurant Tests -->
            <section class="my-4">
                <h2>Testes em Tempo Real - Restaurantes</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Adicionar Restaurante</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <input type="text" id="restaurant-name" class="form-control" placeholder="Nome do restaurante">
                                </div>
                                <div class="mb-2">
                                    <select id="restaurant-price" class="form-select">
                                        <option value="R$ 10-30">R$ 10-30</option>
                                        <option value="R$ 30-50">R$ 30-50</option>
                                        <option value="R$ 50-80">R$ 50-80</option>
                                    </select>
                                </div>
                                <button class="btn btn-success" onclick="addRestaurantRealtime()">
                                    üÜï Adicionar em Tempo Real
                                </button>
                                <div id="restaurant-test-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Restaurantes em Tempo Real</h5>
                            </div>
                            <div class="card-body">
                                <div id="realtime-restaurants" style="max-height: 300px; overflow-y: auto;">
                                    <div class="text-center">üîÑ Carregando restaurantes...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-time Review Tests -->
            <section class="my-4">
                <h2>Testes em Tempo Real - Avalia√ß√µes</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Adicionar Avalia√ß√£o</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="review-restaurant" class="form-label fw-bold">üè™ Selecione um restaurante para avaliar:</label>
                                    <select id="review-restaurant" class="form-select" onchange="onRestaurantSelectChange()">
                                        <option value="">-- Escolha um restaurante --</option>
                                    </select>
                                    <div class="form-text">Selecione um restaurante para ver e adicionar avalia√ß√µes</div>
                                </div>
                                <div class="mb-2">
                                    <input type="number" id="review-quality" class="form-control" min="0" max="5" step="0.5" placeholder="Qualidade (0-5)">
                                </div>
                                <div class="mb-2">
                                    <input type="text" id="review-user" class="form-control" placeholder="Seu nome">
                                </div>
                                <button class="btn btn-success" onclick="addReviewRealtime()">
                                    ‚≠ê Avaliar em Tempo Real
                                </button>
                                <div id="review-test-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Avalia√ß√µes em Tempo Real</h5>
                            </div>
                            <div class="card-body">
                                <div id="realtime-reviews" style="max-height: 250px; overflow-y: auto;">
                                    <div class="text-center">üîÑ Selecione um restaurante</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity Log -->
            <section class="my-4">
                <h2>Log de Atividades</h2>
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Atividades Recentes</h5>
                        <button class="btn btn-outline-secondary btn-sm" onclick="clearActivityLog()">
                            Limpar Log
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="activity-log" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>
</html>