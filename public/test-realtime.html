<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Real-time Data Synchronization</title>
    <meta name="description" content="Test page for real-time data synchronization features">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../src/styles.css">

    <!-- Firebase Configuration (embedded) -->
    <script>
        // Firebase Configuration for Esplanada Eats
        const firebaseConfig = {
            apiKey: "AIzaSyBL8Juo6PJQtFJx1KoJU7KGlc_OndCF3Ls",
            authDomain: "esplanada-eats.firebaseapp.com",
            projectId: "esplanada-eats",
            storageBucket: "esplanada-eats.firebasestorage.app",
            messagingSenderId: "403394772779",
            appId: "1:403394772779:web:8db461c61fc21f9e418f6e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize services
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();

        // Database references
        const restaurantsRef = db.collection('restaurants');
        const reviewsRef = db.collection('reviews');

        // Enable offline persistence
        db.enablePersistence({ synchronizeTabs: true })
            .then(() => console.log('‚úÖ Firestore offline persistence enabled'))
            .catch(err => console.error('‚ùå Persistence error:', err));
    </script>

    <!-- Real-time Service -->
    <script src="../src/realtime-service.js"></script>
</head>
<body>
    <div class="container">
        <header class="text-center py-4">
            <h1>‚ö° Test: Real-time Data Synchronization</h1>
            <p class="lead">Story 0.3: Testando sincroniza√ß√£o em tempo real e colabora√ß√£o</p>
        </header>

        <!-- Connection Status -->
        <div id="connection-status" class="alert alert-info text-center">
            <span id="connection-status-text">Verificando conex√£o...</span>
            <span id="offline-queue-count" class="badge bg-warning ms-2" style="display: none;">0</span>
        </div>

        <!-- Offline Queue Indicator -->
        <div id="offline-queue" class="alert alert-warning" style="display: none;">
            <small>üì¥ Opera√ß√µes pendentes de sincroniza√ß√£o</small>
        </div>

        <main>
            <!-- Real-time Status -->
            <section class="my-4">
                <h2>Status em Tempo Real</h2>
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Conex√£o</h5>
                            </div>
                            <div class="card-body">
                                <div id="connection-indicator">üîÑ Verificando...</div>
                                <button class="btn btn-sm btn-outline-primary mt-2" onclick="checkConnection()">
                                    Verificar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Restaurantes</h5>
                            </div>
                            <div class="card-body">
                                <div id="restaurant-count">üîÑ Carregando...</div>
                                <div class="form-check mt-2">
                                    <input type="checkbox" id="restaurant-listener" class="form-check-input">
                                    <label for="restaurant-listener" class="form-check-label">Listener ativo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Avalia√ß√µes</h5>
                            </div>
                            <div class="card-body">
                                <div id="review-count">üîÑ Carregando...</div>
                                <div class="form-check mt-2">
                                    <input type="checkbox" id="review-listener" class="form-check-input">
                                    <label for="review-listener" class="form-check-label">Listener ativo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5>Performance</h5>
                            </div>
                            <div class="card-body">
                                <div id="performance-metrics">üîÑ Carregando...</div>
                                <button class="btn btn-sm btn-outline-info mt-2" onclick="refreshMetrics()">
                                    Atualizar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-time Restaurant Tests -->
            <section class="my-4">
                <h2>Testes em Tempo Real - Restaurantes</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Adicionar Restaurante (em tempo real)</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <input type="text" id="restaurant-name" class="form-control" placeholder="Nome do restaurante">
                                </div>
                                <div class="mb-2">
                                    <select id="restaurant-price" class="form-select">
                                        <option value="R$ 10-30">R$ 10-30</option>
                                        <option value="R$ 30-50">R$ 30-50</option>
                                        <option value="R$ 50-80">R$ 50-80</option>
                                    </select>
                                </div>
                                <button class="btn btn-success" onclick="addRestaurantRealtime()">
                                    üÜï Adicionar em Tempo Real
                                </button>
                                <button class="btn btn-warning" onclick="simulateRapidUpdates()">
                                    ‚ö° Simular Atualiza√ß√µes R√°pidas
                                </button>
                                <div id="restaurant-test-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Restaurantes em Tempo Real</h5>
                            </div>
                            <div class="card-body">
                                <div id="realtime-restaurants" style="max-height: 300px; overflow-y: auto;">
                                    <div class="text-center">üîÑ Aguardando atualiza√ß√µes...</div>
                                </div>
                                <button class="btn btn-outline-danger btn-sm mt-2" onclick="clearRestaurants()">
                                    Limpar Lista
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-time Review Tests -->
            <section class="my-4">
                <h2>Testes em Tempo Real - Avalia√ß√µes</h2>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Adicionar Avalia√ß√£o</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <select id="review-restaurant" class="form-select">
                                        <option value="">Selecione um restaurante</option>
                                    </select>
                                </div>
                                <div class="mb-2">
                                    <input type="number" id="review-quality" class="form-control" min="0" max="5" step="0.5" placeholder="Qualidade (0-5)">
                                </div>
                                <div class="mb-2">
                                    <input type="text" id="review-user" class="form-control" placeholder="Seu nome">
                                </div>
                                <button class="btn btn-success" onclick="addReviewRealtime()">
                                    ‚≠ê Avaliar em Tempo Real
                                </button>
                                <div id="review-test-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Avalia√ß√µes em Tempo Real</h5>
                            </div>
                            <div class="card-body">
                                <div id="realtime-reviews" style="max-height: 250px; overflow-y: auto;">
                                    <div class="text-center">üîÑ Selecione um restaurante</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Teste de Conflito</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-danger" onclick="simulateConflict()">
                                    ‚öîÔ∏è Simular Conflito
                                </button>
                                <button class="btn btn-warning" onclick="simulateOfflineMode()">
                                    üì¥ Modo Offline
                                </button>
                                <div id="conflict-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Connection Tests -->
            <section class="my-4">
                <h2>Testes de Conex√£o</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Controle de Conex√£o</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-outline-primary" onclick="forceOnline()">
                                    üü¢ For√ßar Online
                                </button>
                                <button class="btn btn-outline-warning" onclick="forceOffline()">
                                    üü° For√ßar Offline
                                </button>
                                <button class="btn btn-outline-info" onclick="testConnectionRecovery()">
                                    üîÑ Testar Recupera√ß√£o
                                </button>
                                <div id="connection-test-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Status Detalhado</h5>
                            </div>
                            <div class="card-body">
                                <div id="detailed-status">
                                    <div>Estado: <span id="state-text">Verificando...</span></div>
                                    <div>Queue: <span id="queue-size">0</span> opera√ß√µes</div>
                                    <div>√öltima atualiza√ß√£o: <span id="last-update">Nunca</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity Log -->
            <section class="my-4">
                <h2>Log de Atividades em Tempo Real</h2>
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Atividades Recentes</h5>
                        <button class="btn btn-outline-secondary btn-sm" onclick="clearActivityLog()">
                            Limpar Log
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="activity-log" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Test Scripts -->
    <script>
        // Global variables
        let realtimeService = window.EsplanadaEatsRealtime;
        let currentRestaurants = [];
        let currentReviews = [];
        let activityCount = 0;

        // Initialize on page load
        window.addEventListener('load', () => {
            initializeRealtimeTests();
        });

        function initializeRealtimeTests() {
            logActivity('üöÄ Initializing real-time tests...');

            // Setup restaurant listener
            realtimeService.setupRestaurantsListener((updates) => {
                handleRestaurantUpdates(updates);
            });

            // Setup connection monitoring
            realtimeService.registerCallback('connection', (state) => {
                updateConnectionStatus(state);
            });

            // Load initial data
            loadInitialData();

            // Setup periodic status updates
            setInterval(updateDetailedStatus, 1000);

            logActivity('‚úÖ Real-time tests initialized');
        }

        function handleRestaurantUpdates(updates) {
            logActivity(`üìä Restaurant updates: ${updates.added.length} added, ${updates.modified.length} modified, ${updates.removed.length} removed`);

            // Handle added restaurants
            updates.added.forEach(restaurant => {
                currentRestaurants.push(restaurant);
                addRestaurantToUI(restaurant, 'added');
                updateRestaurantSelect(restaurant, 'add');
            });

            // Handle modified restaurants
            updates.modified.forEach(restaurant => {
                const index = currentRestaurants.findIndex(r => r.id === restaurant.id);
                if (index !== -1) {
                    currentRestaurants[index] = restaurant;
                    updateRestaurantInUI(restaurant);
                }
            });

            // Handle removed restaurants
            updates.removed.forEach(restaurant => {
                currentRestaurants = currentRestaurants.filter(r => r.id !== restaurant.id);
                removeRestaurantFromUI(restaurant.id);
                updateRestaurantSelect(restaurant, 'remove');
            });

            // Update counts
            updateRestaurantCount();
        }

        function addRestaurantToUI(restaurant, action = 'added') {
            const container = document.getElementById('realtime-restaurants');
            const restaurantDiv = document.createElement('div');
            restaurantDiv.id = `restaurant-${restaurant.id}`;
            restaurantDiv.className = `restaurant-item alert ${action === 'added' ? 'alert-success' : 'alert-info'} mb-2`;
            restaurantDiv.style.animation = 'slideIn 0.5s ease-out';

            const rating = restaurant.averageQuality || 0;
            const stars = '‚≠ê'.repeat(Math.floor(rating)) + (rating % 1 >= 0.5 ? 'üåü' : '');

            restaurantDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <strong>${restaurant.name}</strong>
                        <div class="small">
                            ${restaurant.price} | ${restaurant.vegetarianOptions} | ${restaurant.access}
                        </div>
                        <div class="small text-muted">
                            ${stars} (${rating.toFixed(1)}/5) | ${restaurant.totalRatings || 0} avalia√ß√µes
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-primary">${action === 'added' ? 'Novo' : 'Atualizado'}</div>
                        <div class="small text-muted">${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
            `;

            container.insertBefore(restaurantDiv, container.firstChild);

            // Keep only last 10 restaurants visible
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        function updateRestaurantInUI(restaurant) {
            const element = document.getElementById(`restaurant-${restaurant.id}`);
            if (element) {
                element.className = 'restaurant-item alert alert-warning mb-2';
                element.querySelector('.badge').textContent = 'Atualizado';
                element.querySelector('.text-end .small').textContent = new Date().toLocaleTimeString();
            }
        }

        function removeRestaurantFromUI(restaurantId) {
            const element = document.getElementById(`restaurant-${restaurantId}`);
            if (element) {
                element.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => element.remove(), 500);
            }
        }

        function updateRestaurantSelect(restaurant, action) {
            const select = document.getElementById('review-restaurant');
            if (action === 'add') {
                const option = document.createElement('option');
                option.value = restaurant.id;
                option.textContent = restaurant.name;
                select.appendChild(option);
            } else if (action === 'remove') {
                const option = select.querySelector(`option[value="${restaurant.id}"]`);
                if (option) option.remove();
            }
        }

        function updateRestaurantCount() {
            document.getElementById('restaurant-count').textContent = `üçΩÔ∏è ${currentRestaurants.length} restaurantes`;
            document.getElementById('restaurant-listener').checked = true;
        }

        async function addRestaurantRealtime() {
            const name = document.getElementById('restaurant-name').value.trim();
            const price = document.getElementById('restaurant-price').value;

            if (!name) {
                showTestResult('restaurant-test-result', '‚ö†Ô∏è Digite o nome do restaurante', 'warning');
                return;
            }

            logActivity(`üÜï Adding restaurant: ${name}`);

            const restaurantData = {
                name: name,
                hours: '12h00-23h00',
                price: price,
                vegetarianOptions: 'Algumas',
                access: 'Simples',
                description: `Restaurant added via real-time test at ${new Date().toLocaleTimeString()}`,
                averageQuality: 0,
                totalRatings: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                // Use optimistic update
                const docRef = restaurantsRef.doc();
                const originalData = null;

                const result = await realtimeService.optimisticUpdate(docRef, restaurantData, originalData);

                showTestResult('restaurant-test-result', `‚úÖ Restaurante "${name}" adicionado em tempo real!`, 'success');
                document.getElementById('restaurant-name').value = '';

                logActivity(`‚úÖ Restaurant added successfully: ${name}`);

            } catch (error) {
                showTestResult('restaurant-test-result', `‚ùå Erro: ${error.message}`, 'error');
                logActivity(`‚ùå Failed to add restaurant: ${error.message}`);
            }
        }

        async function simulateRapidUpdates() {
            logActivity('‚ö° Starting rapid update simulation...');

            const updates = [];
            const baseName = 'Test Restaurant';

            for (let i = 0; i < 5; i++) {
                setTimeout(async () => {
                    const restaurantData = {
                        name: `${baseName} - Rapid ${i + 1}`,
                        hours: '12h00-23h00',
                        price: 'R$ 30-50',
                        vegetarianOptions: 'Algumas',
                        access: 'Simples',
                        description: `Rapid test ${i + 1}`,
                        averageQuality: Math.random() * 5,
                        totalRatings: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    try {
                        await restaurantsRef.add(restaurantData);
                        logActivity(`‚ö° Rapid update ${i + 1} completed`);
                    } catch (error) {
                        logActivity(`‚ùå Rapid update ${i + 1} failed: ${error.message}`);
                    }
                }, i * 200); // 200ms intervals
            }

            showTestResult('restaurant-test-result', '‚ö° Simula√ß√£o de atualiza√ß√µes r√°pidas iniciada!', 'info');
        }

        async function addReviewRealtime() {
            const restaurantId = document.getElementById('review-restaurant').value;
            const quality = parseFloat(document.getElementById('review-quality').value);
            const userName = document.getElementById('review-user').value.trim();

            if (!restaurantId || !quality || !userName) {
                showTestResult('review-test-result', '‚ö†Ô∏è Preencha todos os campos', 'warning');
                return;
            }

            const restaurant = currentRestaurants.find(r => r.id === restaurantId);
            if (!restaurant) {
                showTestResult('review-test-result', '‚ö†Ô∏è Restaurante n√£o encontrado', 'warning');
                return;
            }

            logActivity(`‚≠ê Adding review for ${restaurant.name} by ${userName}`);

            const reviewData = {
                restaurantId: restaurantId,
                userName: userName,
                userFingerprint: 'test-fingerprint-' + Date.now(),
                quality: quality,
                price: quality * 0.8, // Slightly lower than quality
                access: 'Simples',
                vegetarianOptions: 'Algumas',
                comment: `Real-time test review by ${userName}`,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await reviewsRef.add(reviewData);
                showTestResult('review-test-result', `‚úÖ Avalia√ß√£o adicionada para "${restaurant.name}"!`, 'success');
                document.getElementById('review-quality').value = '';
                document.getElementById('review-user').value = '';
                logActivity(`‚úÖ Review added successfully`);
            } catch (error) {
                showTestResult('review-test-result', `‚ùå Erro: ${error.message}`, 'error');
                logActivity(`‚ùå Failed to add review: ${error.message}`);
            }
        }

        async function simulateConflict() {
            logActivity('‚öîÔ∏è Starting conflict simulation...');

            if (currentRestaurants.length === 0) {
                showTestResult('conflict-result', '‚ö†Ô∏è Adicione um restaurante primeiro', 'warning');
                return;
            }

            const restaurant = currentRestaurants[0];
            const docRef = restaurantsRef.doc(restaurant.id);

            try {
                // Get original data
                const originalDoc = await docRef.get();
                const originalData = originalDoc.data();

                // Simulate concurrent updates
                const update1 = { averageQuality: 5.0, updatedAt: new Date() };
                const update2 = { averageQuality: 4.5, updatedAt: new Date() };

                logActivity('‚öîÔ∏è Applying conflicting updates...');

                // Apply both updates rapidly
                await Promise.all([
                    docRef.update(update1),
                    setTimeout(() => docRef.update(update2), 100)
                ]);

                showTestResult('conflict-result', '‚öîÔ∏è Conflito simulado com sucesso!', 'success');
                logActivity('‚úÖ Conflict simulation completed');

            } catch (error) {
                showTestResult('conflict-result', `‚ùå Erro: ${error.message}`, 'error');
                logActivity(`‚ùå Conflict simulation failed: ${error.message}`);
            }
        }

        async function simulateOfflineMode() {
            logActivity('üì¥ Starting offline mode simulation...');

            // Temporarily disable network
            const originalOnLine = navigator.onLine;
            Object.defineProperty(navigator, 'onLine', {
                get: () => false,
                configurable: true
            });

            // Trigger offline event
            window.dispatchEvent(new Event('offline'));

            showTestResult('connection-test-result', 'üì¥ Modo offline simulado! Tente adicionar um restaurante.', 'info');

            // Restore online after 10 seconds
            setTimeout(() => {
                Object.defineProperty(navigator, 'onLine', {
                    get: () => true,
                    configurable: true
                });
                window.dispatchEvent(new Event('online'));
                logActivity('üü¢ Connection restored');
            }, 10000);
        }

        function forceOnline() {
            window.dispatchEvent(new Event('online'));
            showTestResult('connection-test-result', 'üü¢ For√ßado modo online', 'success');
            logActivity('üü¢ Forced online mode');
        }

        function forceOffline() {
            window.dispatchEvent(new Event('offline'));
            showTestResult('connection-test-result', 'üü° For√ßado modo offline', 'warning');
            logActivity('üü° Forced offline mode');
        }

        async function testConnectionRecovery() {
            logActivity('üîÑ Testing connection recovery...');

            // Simulate connection loss
            forceOffline();

            // Add some operations while offline
            setTimeout(() => {
                logActivity('üì¥ Adding operations while offline...');
                showTestResult('connection-test-result', 'üì¥ Opera√ß√µes adicionadas enquanto offline', 'info');
            }, 1000);

            // Recover connection
            setTimeout(() => {
                forceOnline();
                showTestResult('connection-test-result', 'üîÑ Conex√£o recuperada! Sincronizando opera√ß√µes...', 'success');
                logActivity('‚úÖ Connection recovery test completed');
            }, 3000);
        }

        function updateConnectionStatus(state) {
            logActivity(`üîÑ Connection state changed: ${state}`);
            document.getElementById('connection-indicator').textContent =
                state === 'online' ? 'üü¢ Online' : 'üü° Offline';
        }

        function updateDetailedStatus() {
            const connectionState = realtimeService.getConnectionState();
            document.getElementById('state-text').textContent = connectionState.state;
            document.getElementById('queue-size').textContent = connectionState.offlineQueueSize;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();

            // Update performance metrics
            const metrics = realtimeService.performanceOptimizer?.getMetrics();
            if (metrics) {
                document.getElementById('performance-metrics').innerHTML = `
                    <div class="small">Cache: ${metrics.cacheSize}</div>
                    <div class="small">Timers: ${metrics.activeDebounceTimers}</div>
                    <div class="small">Queue: ${metrics.queuedUpdates}</div>
                `;
            }
        }

        async function loadInitialData() {
            try {
                const snapshot = await restaurantsRef.get();
                currentRestaurants = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Populate restaurant select
                currentRestaurants.forEach(restaurant => {
                    updateRestaurantSelect(restaurant, 'add');
                });

                updateRestaurantCount();
                logActivity(`üìä Loaded ${currentRestaurants.length} initial restaurants`);

            } catch (error) {
                logActivity(`‚ùå Failed to load initial data: ${error.message}`);
            }
        }

        function refreshMetrics() {
            updateDetailedStatus();
            showTestResult('restaurant-test-result', 'üìä M√©tricas atualizadas', 'info');
        }

        function clearRestaurants() {
            const container = document.getElementById('realtime-restaurants');
            container.innerHTML = '<div class="text-center">üîÑ Lista limpa</div>';
            logActivity('üßπ Cleared restaurant display');
        }

        function checkConnection() {
            const state = realtimeService.getConnectionState();
            showTestResult('restaurant-test-result', `üìä Status: ${state.state} (${state.offlineQueueSize} na fila)`, 'info');
        }

        function clearActivityLog() {
            document.getElementById('activity-log').innerHTML = '';
            activityCount = 0;
            logActivity('üßπ Activity log cleared');
        }

        function showTestResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };

            element.innerHTML = `<div style="color: ${colors[type]}; font-weight: bold;">${message}</div>`;
        }

        function logActivity(message) {
            const logDiv = document.getElementById('activity-log');
            if (logDiv) {
                const timestamp = new Date().toLocaleTimeString();
                const count = ++activityCount;
                const logEntry = document.createElement('div');
                logEntry.style.marginBottom = '2px';
                logEntry.innerHTML = `<small>[${timestamp}] #${count} ${message}</small>`;
                logDiv.appendChild(logEntry);
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(-100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }

            .restaurant-item {
                transition: all 0.3s ease;
            }

            .connection-indicator {
                padding: 0.5rem;
                border-radius: 0.5rem;
                font-weight: bold;
            }

            .connection-indicator.online {
                background-color: #d4edda;
                color: #155724;
            }

            .connection-indicator.offline {
                background-color: #fff3cd;
                color: #856404;
            }
        `;
        document.head.appendChild(style);

        console.log('üöÄ Real-time Data Synchronization Test Page Loaded');
    </script>
</body>
</html>